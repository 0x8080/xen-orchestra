import angular from 'angular'
import angularAnimate from 'angular-animate'
import angularNotifyToaster from 'angular-notify-toaster'

const {isString} = angular

// ===================================================================

// High level integration of XO API in xo-web.
export default angular.module('xo-notify', [
  angularAnimate,
  angularNotifyToaster
])
  .service('xoNotify', (toaster) => {
    function makeNotifier (level) {
      return function notifier (options) {
        if (isString(options)) {
          options = { message: options }
        } else if (!options.message) {
          throw new Error('missing message')
        }

        toaster.pop(
          level,
          options.title || 'Xen-Orchestra',
          options.message
        )
      }
    }

    return {
      warning: makeNotifier('warning'),
      error: makeNotifier('error'),
      info: makeNotifier('info')
      // TODO: It is probably a bad design to have notification for
      // successful operations.
      // success: makeNotifier 'success'
    }
  })
  .name
